<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Game Result</title>
  <link href="Frame 545.png" rel="icon">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
      color: #e0e0e0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .animated-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(0, 204, 255, 0.15), transparent 70%);
      animation: pulse 5s infinite;
      z-index: -1;
    }
   .math-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  z-index: -1;
}

.math-symbol {
  position: absolute;
  color: var(--blue-accent);
  font-weight: bold;
  animation: float 10s infinite ease-in-out;
  opacity: 0.6;
}

@keyframes float {
  0% {
    transform: translateY(100vh) rotate(0deg);
  }
  100% {
    transform: translateY(-100vh) rotate(360deg);
  }
}
    .container {
      background: rgba(20, 20, 20, 0.95);
      border-radius: 15px;
      padding: 2rem 3rem;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
      text-align: center;
      max-width: 600px;
      width: 90%;
      animation: fadeIn 1s ease-out;
    }
    h1 {
      font-size: 2.8rem;
      margin-bottom: 1rem;
      color: #00ccff;
    }
    p {
      font-size: 1.3rem;
      margin: 0.8rem 0;
      line-height: 1.5;
    }
    .score {
      font-weight: bold;
      color: #00ccff;
    }
    .outcome {
      font-weight: bold;
    }
    .win {
      color: #00ccff;
    }
    .loss {
      color: #ff4d4d;
    }
    .rating {
      margin-top: 1.5rem;
      font-size: 1.2rem;
    }
    .btn {
      margin-top: 2rem;
      background-color: transparent;
      color: #e0e0e0;
      padding: 0.8rem 2rem;
      font-size: 1rem;
      border: 2px solid;
      border-image-slice: 1;
      border-image-source: linear-gradient(to right, #00ccff, #ffffff);
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      text-decoration: none;
      display: inline-block;
    }
    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(0, 204, 255, 0.7);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

    <div class="math-bg" id="math-bg"></div>
  <div class="animated-bg"></div>
  <div class="container">
    <h1>Game Result</h1>
    <p id="scoreDisplay">Loading scores...</p>
    <p id="outcomeDisplay"></p>
    <p id="ratingDisplay" class="rating"></p>
    <a href="mainpage.html" class="btn">Return to Main Page</a>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js';
    import { getFirestore, doc, getDoc, updateDoc, runTransaction } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js';

    // Firebase configuration (same as in game)
    const firebaseConfig = {
      apiKey: "AIzaSyBF5w8l2TiH1OTFho-N4qBlVzgC5fw8dG4",
      authDomain: "techsprint-53b5c.firebaseapp.com",
      projectId: "techsprint-53b5c",
      storageBucket: "techsprint-53b5c.appspot.com",
      messagingSenderId: "366810852442",
      appId: "1:366810852442:web:d31260159a6c8b1c307c63",
      measurementId: "G-PTPH19Z3QG"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Retrieve final scores from local storage
    const finalScoresStr = localStorage.getItem('finalScores');
    if (!finalScoresStr) {
      document.getElementById('scoreDisplay').textContent = "No game results available.";
    }
    const finalScores = JSON.parse(finalScoresStr);
    const userScore = finalScores.user;
    const opponentScore = finalScores.opponent;
    document.getElementById('scoreDisplay').innerHTML = 
      `Your Score: <span class="score">${userScore}</span> | Opponent's Score: <span class="score">${opponentScore}</span>`;

    // Determine game outcome and rating adjustment
    let outcomeText = '';
    let ratingAdjustment = 0;
    if (userScore > opponentScore) {
      outcomeText = "Congratulations! You won the game.";
      ratingAdjustment = 100;
    } else if (userScore < opponentScore) {
      outcomeText = "Sorry, you lost the game.";
      ratingAdjustment = -50;
    } else {
      outcomeText = "It's a tie!";
      ratingAdjustment = 0;
    }
    const outcomeDisplay = document.getElementById('outcomeDisplay');
    outcomeDisplay.textContent = outcomeText;
    outcomeDisplay.classList.add(userScore > opponentScore ? "win" : (userScore < opponentScore ? "loss" : ""));

    // Update user's rating in Firebase and display the new rating
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const userRef = doc(db, "users", user.email);
        try {
          await runTransaction(db, async (transaction) => {
            const userDoc = await transaction.get(userRef);
            if (!userDoc.exists()) {
              throw "User document does not exist!";
            }
            const userData = userDoc.data();
            const currentRating = userData.rating || 0;
            const newRating = currentRating + ratingAdjustment;
            transaction.update(userRef, { rating: newRating });
            document.getElementById('ratingDisplay').textContent = 
              `Your new rating: ${newRating} (${ratingAdjustment >= 0 ? '+' : ''}${ratingAdjustment} applied)`;
          });
        } catch (e) {
          console.error("Transaction failed: ", e);
          document.getElementById('ratingDisplay').textContent = "Error updating rating.";
        }
      }
    });
    const symbols = ['+', '-', '\u00D7', '\u00F7', '=', '\u221A', '\u03C0', '\u222B'];
    const container = document.getElementById('math-bg');

    for (let i = 0; i < 100; i++) {
      const symbol = document.createElement('div');
      symbol.classList.add('math-symbol');
      symbol.textContent = symbols[Math.floor(Math.random() * symbols.length)];
      symbol.style.left = Math.random() * 100 + 'vw';
      symbol.style.top = Math.random() * 100 + 'vh';
      symbol.style.fontSize = Math.random() * 3 + 1 + 'rem';
      symbol.style.animationDuration = (5 + Math.random() * 10) + 's';
      container.appendChild(symbol);
    }
  </script>
</body>
</html>
